<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Stripline Calculator (W ↔ Z₀)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
      line-height: 1.6;
    }
    h1, h2, h3 {
      color: #333;
    }
    label {
      display: inline-block;
      width: 240px;
      margin-bottom: 5px;
    }
    input[type="number"] {
      margin-bottom: 10px;
      padding: 5px;
      width: 120px;
    }
    .common-flex {
      display: flex;
      gap: 20px;
      margin-bottom: 30px;
    }
    .common-container, .diagram-container {
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
      background-color: #f9f9f9;
    }
    .common-container {
      flex: 1;
    }
    .diagram-container {
      flex: 1;
      text-align: center;
    }
    .calc-container {
      display: flex;
      gap: 20px;
      margin-bottom: 30px;
    }
    .section {
      flex: 1;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
      background-color: #f9f9f9;
    }
    .result-container {
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
      background-color: #f9f9f9;
      margin-bottom: 30px;
      text-align: center;
    }
    .formula, .references {
      margin-bottom: 30px;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
      background-color: #f9f9f9;
    }
    button {
      padding: 8px 15px;
      font-size: 14px;
      cursor: pointer;
      margin-top: 10px;
    }
    img {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 0 auto;
    }
  </style>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
  <h1>Stripline Calculator (W ↔ Z₀)</h1>

  <div class="common-flex">
    <div class="common-container">
      <h2>Common Parameters</h2>
      <label for="common-b">Substrate Height (b) [mm]:</label>
      <input type="number" id="common-b" step="any" value="2.0"><br>
      <label for="common-eps">Dielectric Constant (εᵣ):</label>
      <input type="number" id="common-eps" step="any" value="3.8"><br>
      <label for="common-t">Conductor Thickness (t) [µm]:</label>
      <input type="number" id="common-t" step="any" value="35"><br>
      <label for="common-f">Frequency (f) [GHz]:</label>
      <input type="number" id="common-f" step="any" value="1"><br>
    </div>
    <div class="diagram-container">
      <h2>Cross Section Diagram</h2>
      <img src="https://emlizard.github.io/main-page/images/diagram_Stripline.png" alt="Stripline diagram">
    </div>
  </div>

  <div class="calc-container">
    <div class="section">
      <h2>W to Z₀ Calculation</h2>
      <label for="ms-W-input">Signal Line Width W [mm]:</label>
      <input type="number" id="ms-W-input" step="any" value="1"><br>
      <button onclick="calculateZ0_fromW()">Calculate</button>
    </div>
    <div class="section">
      <h2>Z₀ to W Calculation</h2>
      <label for="ms-Z0-input">Target Z₀ [Ohm]:</label>
      <input type="number" id="ms-Z0-input" step="any" value="50"><br>
      <button onclick="calculateW_fromZ0()">Calculate</button>
    </div>
  </div>

  <div class="result-container">
    <h2>Calculation Result</h2>
    <div id="resultArea"></div>
  </div>

  <div class="formula">
    <h2>Formulas Used</h2>
    <p>
      \[ W_{\mathrm{eff}} = W + \frac{t}{\pi} \ln\left(1 + \frac{4 e b}{t}\right) \]
    </p>
    <p>
      \[ f_p = \frac{c}{4b\sqrt{\epsilon_r}}, \quad \epsilon_{\text{low}} = \epsilon_r - 0.2 \]
      \[ \epsilon_{\text{eff}} = \epsilon_{\text{low}} + (\epsilon_r - \epsilon_{\text{low}}) (1 - e^{-f/f_p}) \]
    </p>
    <p>
      \[ Z_0 = \frac{30\pi}{\sqrt{\epsilon_{\text{eff}}}} \cdot \frac{1}{W_{\text{eff}}/b + 0.441} \]
    </p>
  </div>

  <div class="references">
    <h2>References</h2>
    <p>H. A. Wheeler, Pozar: Microwave Engineering</p>
  </div>

  <script>
    function getCommonParams() {
      const b = parseFloat(document.getElementById("common-b").value) / 1000;
      const eps_r = parseFloat(document.getElementById("common-eps").value);
      const t = parseFloat(document.getElementById("common-t").value) * 1e-6;
      const f = parseFloat(document.getElementById("common-f").value);
      return { b, eps_r, t, f };
    }

    function effectiveWidth(W, t, b) {
      return W + (t / Math.PI) * Math.log(1 + (4 * Math.E * b) / t);
    }

    function effectiveEps(eps_r, b, f) {
      const eps_low = eps_r - 0.2;
      const fp = 3e8 / (4 * b * Math.sqrt(eps_r));
      const fHz = f * 1e9;
      return eps_low + (eps_r - eps_low) * (1 - Math.exp(-fHz / fp));
    }

    function calcZ0_strip(W_mm, params) {
      const W = W_mm / 1000;
      const W_eff = effectiveWidth(W, params.t, params.b);
      const eps_eff = effectiveEps(params.eps_r, params.b, params.f);
      const Z0 = (30 * Math.PI / Math.sqrt(eps_eff)) / (W_eff / params.b + 0.441);
      return { Z0, eps_eff };
    }

    function calculateZ0_fromW() {
      const params = getCommonParams();
      const W_mm = parseFloat(document.getElementById("ms-W-input").value);
      const result = calcZ0_strip(W_mm, params);
      document.getElementById("resultArea").innerHTML =
        `Calculated Characteristic Impedance Z₀ = ${result.Z0.toFixed(2)} Ohm<br>` +
        `Effective Dielectric Constant ε_eff = ${result.eps_eff.toFixed(3)}`;
    }

    function calculateW_fromZ0() {
      const params = getCommonParams();
      const targetZ0 = parseFloat(document.getElementById("ms-Z0-input").value);
      let W_guess = params.b * 1000;
      let tol = 1e-6;
      for (let i = 0; i < 100; i++) {
        const res = calcZ0_strip(W_guess, params);
        const f_val = res.Z0 - targetZ0;
        if (Math.abs(f_val) < tol) break;
        const dW = 1e-3;
        const Zp = calcZ0_strip(W_guess + dW, params).Z0;
        const Zm = calcZ0_strip(W_guess - dW, params).Z0;
        const deriv = (Zp - Zm) / (2 * dW);
        W_guess -= f_val / deriv;
      }
      const final = calcZ0_strip(W_guess, params);
      document.getElementById("resultArea").innerHTML =
        `Target Z₀ = ${targetZ0} Ohm corresponds to W = ${W_guess.toFixed(4)} mm<br>` +
        `Effective Dielectric Constant ε_eff = ${final.eps_eff.toFixed(3)}`;
    }
  </script>
</body>
</html>
